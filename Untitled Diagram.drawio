<mxfile host="app.diagrams.net" modified="2022-06-05T09:03:05.073Z" agent="5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.136 Safari/537.36" etag="n5HcgRhSyM_oFp9Ec4kg" version="19.0.0" type="github">
  <diagram id="n2Pa9MUhGyrB7lN07nK0" name="Page-1">
    <mxGraphModel dx="1689" dy="457" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="3LP0clArs9973cQA3RRX-39" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontFamily=Times New Roman;" edge="1" parent="1" source="3LP0clArs9973cQA3RRX-7">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="510" y="590" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-7" value="&lt;div style=&quot;text-align: justify; font-size: 10px;&quot;&gt;&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;Random(n_1)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;M_0 = HMAC_(Sk_SN )(Id_SN ||n_1)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;Send(M_0,n_1)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="420" y="220" width="180" height="67.5" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=14;fontFamily=Times New Roman;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="510" y="250" as="sourcePoint" />
            <mxPoint x="510" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Times New Roman;" edge="1" parent="1" source="3LP0clArs9973cQA3RRX-12" target="3LP0clArs9973cQA3RRX-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-12" value="&lt;br&gt;&lt;br&gt;ID_sn&lt;br&gt;SK_sn&lt;br&gt;T&lt;br&gt;EBC_sn" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.database;whiteSpace=wrap;fontSize=14;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="700" y="193.75" width="70" height="120" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-13" value="Data base" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=14;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="695" y="170" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-17" value="" style="endArrow=classic;html=1;rounded=0;fontFamily=Times New Roman;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="420" y="560" as="sourcePoint" />
            <mxPoint x="510" y="560" as="targetPoint" />
            <Array as="points">
              <mxPoint x="260" y="560" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-18" value="&lt;i style=&quot;font-size: 10px; text-align: left;&quot;&gt;{AID_SN, X, M_1,M_2,mb,r_1}&lt;/i&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="320" y="540" width="180" height="17.5" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontFamily=Times New Roman;" edge="1" parent="1" source="3LP0clArs9973cQA3RRX-23" target="3LP0clArs9973cQA3RRX-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-23" value="&lt;span style=&quot;font-size: 14px; font-weight: 700;&quot;&gt;Gateway&lt;/span&gt;" style="whiteSpace=wrap;html=1;fontSize=10;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="450" y="170" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-29" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontFamily=Times New Roman;" edge="1" parent="1" source="3LP0clArs9973cQA3RRX-27" target="3LP0clArs9973cQA3RRX-28">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-27" value="&lt;span style=&quot;font-size: 14px; font-weight: 700;&quot;&gt;Sensor Node&lt;/span&gt;" style="whiteSpace=wrap;html=1;fontSize=10;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="200" y="170" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-37" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontFamily=Times New Roman;" edge="1" parent="1" source="3LP0clArs9973cQA3RRX-28" target="3LP0clArs9973cQA3RRX-36">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-28" value="&lt;div&gt;&lt;div&gt;&lt;i&gt;M_0&#39;=HMAC_(Sk_SN )(Id_SN || n_1)&amp;nbsp;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;if (M_0&#39;=M_0)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;Continue&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;Else&amp;nbsp;//Sai&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;Exit&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;Random (r_1, v)&amp;nbsp;//sinh số ngẫu nhiên r_1 và v&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;Get rb&amp;nbsp;//giá trị pin hiện tại của sensor&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;mb = rb ⊕ H (Sk_SN ⊕ r1)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;X = v ⊕ H (rb)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;M_1 = H((v ‖ Id_SN) ⊕ H (Sk_SN ))&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;M_2 = HMAC_(Sk_SN )(ID_SN, X, M_1, r_1, mb)&amp;nbsp;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;AID_SN=H(H(Id_SN‖r_1) ⊕ H(Id_SN))&amp;nbsp; //ẩn định danh&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;Send (AID_SN, X, M_1,M_2,mb,r_1)&amp;nbsp;&lt;/i&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br style=&quot;&quot;&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;align=left;verticalAlign=middle;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="130" y="330" width="260" height="170" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-31" value="" style="endArrow=classic;html=1;rounded=0;fontSize=10;fontFamily=Times New Roman;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="510" y="310" as="sourcePoint" />
            <mxPoint x="260" y="310" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-35" value="&lt;i style=&quot;text-align: justify;&quot;&gt;{M_0,n_1}&lt;/i&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="350" y="280" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-45" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontFamily=Times New Roman;" edge="1" parent="1" source="3LP0clArs9973cQA3RRX-36" target="3LP0clArs9973cQA3RRX-44">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-54" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Times New Roman;fontSize=12;" edge="1" parent="1" source="3LP0clArs9973cQA3RRX-36" target="3LP0clArs9973cQA3RRX-53">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-36" value="&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;M_4&#39; = HMAC_(SK_SN )(n_1,r_1,Y,M_3)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;//Kiểm tra tính chính xác của thôn điệp nhận được&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;If (M_4&#39; == M_4)&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;// Chính xác&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;		&lt;/span&gt;Continue&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;Else&lt;span style=&quot;&quot;&gt;				&lt;/span&gt;// Có sự thay đổi&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;		&lt;/span&gt;Exit&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;w′ = Y ⊕ H (SK_SN ⊕ n_1)&amp;nbsp;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;TK_&lt;sub&gt;SN&lt;/sub&gt;&lt;sup&gt;I&lt;/sup&gt; = H(v ⊕ w′ ⊕ SK_SN)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;M_3&#39; = H((TK_&lt;sub&gt;SN&lt;/sub&gt;&lt;sup&gt;I&lt;/sup&gt; ||Id_SN)⊕ H(SK_SN))&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;//Kiểm tra&amp;nbsp;&lt;/i&gt;&lt;i&gt;TK_&lt;sub&gt;SN&lt;/sub&gt;&lt;sup&gt;I&lt;/sup&gt;&amp;nbsp;&lt;/i&gt;&lt;i&gt;có chính xác không&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;If(M_3&#39; == M_3) //giống nhau&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;		&lt;/span&gt;m = w′&amp;nbsp;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font face=&quot;Times New Roman, serif&quot;&gt;&lt;i&gt;Store&lt;/i&gt;&amp;nbsp;(&lt;/font&gt;&lt;/font&gt;&lt;i&gt;TK_&lt;sub&gt;SN&lt;/sub&gt;&lt;sup&gt;I&lt;/sup&gt;)&lt;/i&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;Else&lt;span style=&quot;&quot;&gt;			&lt;/span&gt;//Sai&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;		&lt;/span&gt;Exit&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;align=left;verticalAlign=top;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="140" y="980" width="240" height="210" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-41" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;entryX=0.565;entryY=0.024;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Times New Roman;" edge="1" parent="1" source="3LP0clArs9973cQA3RRX-38" target="3LP0clArs9973cQA3RRX-44">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="579.9999999999998" y="1210.005" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-52" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontFamily=Times New Roman;" edge="1" parent="1" source="3LP0clArs9973cQA3RRX-38" target="3LP0clArs9973cQA3RRX-47">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-38" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;Id_SN =Derive(AId_SN)	//lấy Id_SN từ mã ẩn danh AId_SN&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;M_2&#39; = HMAC_(Sk_SN )(Id_SN, X, M_1, r_1, mb)&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;//Kiểm tra xác thực nội dung thông báo&amp;nbsp;&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;If (M_2&#39; == M_2)&lt;span style=&quot;&quot;&gt;		&lt;/span&gt;//Giống nhau&amp;nbsp;&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;		&lt;/span&gt;Continue&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;Else&lt;span style=&quot;&quot;&gt;				&lt;/span&gt;//Sai&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;		&lt;/span&gt;Exit&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;rb′ = mb ⊕ H(Sk_SN ⊕ r_1)&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;v′ = X ⊕ H (rb′)&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;M_1^&#39; = H ((v′ || Id_SN) ⊕ H (Sk_SN))&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;//Kiểm tra giá trị rb′và v′&amp;nbsp;&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;If(M_1&#39; == M_1)&lt;span style=&quot;&quot;&gt;		&lt;/span&gt;//Chính xác&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;		&lt;/span&gt;Continue&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;Else&lt;span style=&quot;&quot;&gt;				&lt;/span&gt;//Khác nhau&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;		&lt;/span&gt;Exit&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;Retrieve_(Id_SN ) (T,EBC_SN)&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;//Lấy T và EBC_SN từ CSDL&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;BCT_SN=[rb-(EBC_SN/(24 ×60))×T]&amp;nbsp; ×s //ngưỡng pin ước tính còn lại&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;er = rb′&lt;span style=&quot;&quot;&gt;			&lt;/span&gt;//&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;Random(w, n_1)&lt;span style=&quot;&quot;&gt;		&lt;/span&gt;//sinh số w và n_1&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt; Y = w ⊕ H (SK_SN ⊕ n_1)&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;TK_SN^I = H (v′ ⊕ w ⊕ SK_SN) //Mã thông báo ban đầu&amp;nbsp;&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;M_3= H((TK&lt;sub&gt;SN&lt;/sub&gt;&lt;sup&gt;I&lt;/sup&gt; ∥Id_SN) ⊕ SK_SN))&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;M_4= HMAC_(SK_SN )(n_1,r_1,Y,M_3)&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt; Store (&lt;/i&gt;&lt;i&gt;TK&lt;sub&gt;SN&lt;/sub&gt;&lt;sup&gt;I&lt;/sup&gt;&lt;/i&gt;&lt;i&gt;,BCT_SN)&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;//lưu vào CSDL&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;Set t_s = nowtime()&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;//đặt dấu thời gian hiện tại&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;m = w&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;i&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;Send (M_3, M_4, Y, n_1)&lt;span style=&quot;&quot;&gt;		&lt;/span&gt;//gửi đến sensor node&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;align=left;verticalAlign=top;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="400" y="593.75" width="360" height="346.25" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-42" value="" style="endArrow=classic;html=1;rounded=0;fontSize=10;fontFamily=Times New Roman;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="580" y="960" as="sourcePoint" />
            <mxPoint x="260" y="960" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-43" value="&lt;i style=&quot;font-size: 10px; text-align: left;&quot;&gt;{&lt;/i&gt;&lt;i style=&quot;font-size: 10px; text-align: left;&quot;&gt;M_3, M_4, Y, n_1&lt;/i&gt;&lt;i style=&quot;font-size: 10px; text-align: left;&quot;&gt;}&lt;/i&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="250" y="940" width="180" height="17.5" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-44" value="KẾT THÚC" style="ellipse;whiteSpace=wrap;html=1;fontSize=10;align=center;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="370" y="1220" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-46" value="&lt;i style=&quot;text-align: justify;&quot;&gt;Sk_SN , Id_SN&lt;/i&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="620" y="230" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-47" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;br&gt;&lt;br&gt;ID_sn&lt;br&gt;SK_sn&lt;br&gt;T&lt;br&gt;EBC_sn&lt;br&gt;&lt;i style=&quot;text-align: left;&quot;&gt;TK&lt;sub&gt;SN&lt;/sub&gt;&lt;sup&gt;I&lt;br style=&quot;font-size: 12px;&quot;&gt;&lt;/sup&gt;&lt;/i&gt;&lt;i style=&quot;text-align: left;&quot;&gt;BCT_SN&lt;/i&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.database;whiteSpace=wrap;fontSize=14;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="850" y="660.31" width="90" height="213.13" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-51" value="&lt;i style=&quot;font-size: 10px; text-align: left;&quot;&gt;TK&lt;sub&gt;SN&lt;/sub&gt;&lt;sup&gt;I&lt;/sup&gt;&lt;/i&gt;&lt;i style=&quot;font-size: 10px; text-align: left;&quot;&gt;,BCT_SN&lt;/i&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="760" y="740" width="90" height="17.5" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-53" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;br&gt;&lt;br&gt;ID_sn&lt;br&gt;SK_sn&lt;br&gt;&lt;i style=&quot;text-align: left;&quot;&gt;TK&lt;sub&gt;SN&lt;/sub&gt;&lt;sup&gt;I&lt;br style=&quot;font-size: 12px;&quot;&gt;&lt;/sup&gt;&lt;/i&gt;&lt;br&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.database;whiteSpace=wrap;fontSize=14;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry y="1039.22" width="90" height="91.56" as="geometry" />
        </mxCell>
        <mxCell id="3LP0clArs9973cQA3RRX-55" value="&lt;i style=&quot;text-align: left;&quot;&gt;TK&lt;sub&gt;SN&lt;/sub&gt;&lt;sup&gt;I&lt;/sup&gt;&lt;/i&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Times New Roman;" vertex="1" parent="1">
          <mxGeometry x="80" y="1060" width="70" height="17.5" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
